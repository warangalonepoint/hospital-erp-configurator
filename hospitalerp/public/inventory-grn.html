<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRN — Add Stock</title>
<style>
  :root{ --bg:#0b0b10; --card:#14141d; --mut:#a1a1aa; --prim:#0ea5e9 }
  *{ box-sizing:border-box } body{ margin:0; font-family:system-ui; background:var(--bg); color:#fff }
  header{ padding:12px 16px; border-bottom:1px solid #1f1f29; background:#0d0d13 }
  .wrap{ padding:16px }
  .card{ background:var(--card); border:1px solid #2a2a36; border-radius:14px; padding:16px }
  label{ display:block; font-size:12px; color:var(--mut); margin:8px 0 4px }
  input,select{ width:100%; padding:10px 12px; background:#0f0f16; color:#fff; border:1px solid #2a2a36; border-radius:10px }
  .grid{ display:grid; grid-template-columns:1fr; gap:12px }
  @media (min-width:900px){ .grid{ grid-template-columns:1fr 1fr; } }
  .btn{ background:#1a1a24; border:1px solid #2a2a36; padding:10px 12px; border-radius:10px; color:#fff; cursor:pointer }
  .btn.primary{ background:var(--prim); border-color:transparent; color:#001019; font-weight:600 }
</style>
</head>
<body>
<header>
  <div style="display:flex;gap:10px;align-items:center">
    <button class="btn" onclick="history.back()">← Back</button>
    <h3 style="margin:0">Goods Receipt (GRN)</h3>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <form id="grnForm" class="grid">
      <div>
        <label>Item</label>
        <select id="itemSelect"></select>
        <small style="color:var(--mut)">Missing item? <a href="pharmacy.html" style="color:#93c5fd">Create it first</a>.</small>
      </div>
      <div>
        <label>Batch No</label>
        <input name="batchNo" required placeholder="e.g. B2309A">
      </div>
      <div>
        <label>Expiry</label>
        <input name="expiry" type="date" required>
      </div>
      <div>
        <label>Quantity</label>
        <input name="qty" type="number" min="1" required>
      </div>
      <div>
        <label>Buy Price (per unit)</label>
        <input name="buyPrice" type="number" step="0.01">
      </div>
      <div>
        <label>Reference / Invoice No</label>
        <input name="ref" placeholder="optional">
      </div>
      <div style="grid-column:1/-1; display:flex; gap:8px; justify-content:flex-end">
        <button type="button" class="btn" onclick="document.getElementById('grnForm').reset()">Reset</button>
        <button class="btn primary">Save GRN</button>
      </div>
    </form>
  </div>
</div>

<script src="./inventory.js"></script>
<script>
const api = window.InventoryAPI;

async function loadItems(){
  await api.openDB();
  const items = await api.listItems();
  const sel = document.getElementById("itemSelect");
  sel.innerHTML = items.map(i=>`<option value="${i.id}">${i.name} • MRP ₹${i.mrp||0}</option>`).join("");
  if(!items.length){ sel.innerHTML = `<option disabled>No items found</option>`; }
}

document.getElementById("grnForm").onsubmit = async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const itemId = Number(document.getElementById("itemSelect").value);
  if(!itemId) return alert("Select an item");
  const batch = {
    itemId,
    batchNo: f.get("batchNo"),
    expiry: f.get("expiry"),
    qty: Number(f.get("qty")),
    buyPrice: Number(f.get("buyPrice")||0)
  };
  await api.addBatch(batch);
  await api.addMove({type:"grn", itemId, batchId:null, qty:batch.qty, ref:f.get("ref")||"", ts:Date.now()});
  alert("GRN saved ✔");
  e.target.reset();
};

loadItems();
</script>
</body>
</html>
